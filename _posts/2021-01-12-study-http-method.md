---
title: "Http Method restrictions"
excerpt: "Web Server(WebtoB)의 특정 Http Request Method 제한"

categories:
  - Studies
tags:
  - Jeus
  - Webtob
  - WAS
  - Web Server
  - Studies
  - Spring Boot

toc: true
toc_label: "목차"
last_modified_at: 2021-01-12T11:09:00-12:00
---
## 1. 문제 발생

최근 회사에서 진행하고 있는 자체 프로젝트의 관리자 페이지 어플리케이션을 리팩토링하는 중 에러가 발생했다.  
기존의 관리자 페이지는 스프링부트, JPA, HTTP 통신에 대한 이해가 부족할 때 급하게 만들어 소스코드를 볼 때마다 부끄러운 마음이 들었다. (아직도 공부하는 중이다.)  
그러다 해당 프로젝트의 비즈니스 로직을 크게 수정하고 추가할 일이 생겨 겸사겸사 관리자 페이지도 싹 갈아엎었다.~~(다시 만들었다.)~~  
로컬 환경과 회사 개발 환경에서는 테스트를 하여 문제없이 동작하는 것을 확인하고 나름 뿌듯했는데 스테이징 서버와 운영 환경에서는 페이지에서 수정 요청을 할 때마다 에러가 뜨는 것을 발견했다. (여러가지 이유로 캡처하지 못했다.)  
심지어 어플리케이션 로그에서는 해당 로직에 대한 어떤 로그도 나오지 않았다. 
**도대체 뭐가 문제였을까.**

## 2. 원인
처음에는 비즈니스 자체 로직이라 생각하고 열심히 소스코드를 디버깅했지만 원인을 발견하지 못했다.
그래서 어플리케이션 외부 환경과 관련된 문제라고 생각하고 어플리케이션이 작동하는 각 환경을 정리해보았다.

> | ENV | WEB SERVER | WAS |
> |:---:|:----------:|:---:|
> | 로컬 |    내장     | 내장 |
> | 개발 | nginx | tomcat |
> | 스테이징 | webtob | Jeus |
> | 운영 | webtob | Jeus |  



스테이징과 운영 환경에서만 해당 에러가 발생했고, 나중에 확인해본 결과 WAS가 아닌 Web Server 로그에서 해당 요청을 막고 있다는 로그를 발견했다.  
문제는 *HTTP Method*였다.

리팩토링 과정에서 Rest API 형식에 따라 수정 기능이나 삭제 기능 요청 URI의 HTTP Method를 PUT이나 DELETE로 바꾸었는데, 보통 웹 서버나 웹 어플리케이션 서버에서는 보안을 위해 **GET, POST 이외의 Method는 모두 막아버리는 것이다.** 

## 3. 해결

이 문제점에 대한 해결 방법으로는 두 가지가 있었다. 
> 1. PUT, DELETE와 같은 다른 메서드들을 모두 GET, POST 메서드로 변경하기
> 2. 웹 서버나 웹 어플리케이션 서버에서 PUT, DELETE 메서드를 허용해주기

1번은 어플리케이션의 소스코드를 변경하는 대신 웹 서버와 웹 어플리케이션 서버에서 설정을 변경해줄 필요가 없고, 2번은 웹 서버, 웹 어플리케이션 서버의 설정을 변경하는 대신 어플리케이션 소스 코드의 수정을 할 필요가 없다는 특징이 있다. 

이번 프로젝트의 경우에는 스테이징 환경과 운영 환경의 특성 상 GET과 POST 이외에는 모두 막아버려야 했기 때문에 어플리케이션 소스코드를 수정하기로 했다. 개인적으로는 열심히 공부했던 Restful한 API 설계와는 멀어지는 수정이었지만 회사 업무라는 특성 상 어쩔 수 없었다.

혹시나 나와 같은 문제를 겪은 사람들 중에 2번 방법으로 해결할 사람들을 위해 검색한 과정에서 발견한 참고 사이트를 밑에 남겨두겠다. 

[참고]  
[(WebtoB) 특정 Request Method 제한 설정](https://m.blog.naver.com/PostView.nhn?blogId=01032707009&logNo=221068582395&proxyReferer=https:%2F%2Fwww.google.com%2F)  
[(Apache & tomcat) 불필요한 메서드 제한 - 웹 취약점 제거방법](https://hello-nanam.tistory.com/75)

